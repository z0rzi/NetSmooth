
\documentclass[twoside]{article}
\usepackage[francais]{babel}
\usepackage[T1]{fontenc}
\frenchspacing
\author{KostiTeam}
\title{Manuel d'utilisation LXC}
\begin{document}

\maketitle
\newpage
\tableofcontents
\newpage

\section{Bien d\'ebuter}
Toutes les commandes ex\'ecut\'ees sont effectu\'ees en root (super-utilisateur).

\subsection{Installer LXC}
\subsubsection{Arch-linux}
\emph{\#pacman -S lxc arch-install-scripts}
\subsubsection{Debian}
\emph{\#apt-get install lxc}

\subsection{Cr\'eer un container}
\emph{\#lxc-create -t download -n name}: cr\'eer un container de nom name en proposant la liste des images d'OS possibles \`a t\'el\'echarger.\\ 

\emph{\#lxc-create -t download -n name -d debian -r jessie -a i386}: cr\'eer un container de nom \emph{name} en t\'el\'echargeant une image de distribution \emph{debian}, de release \emph{jessie} et d'architecture \emph{i386} (32 bits).\footnote{Cr\'eer un container d'architecture 64 bits sur un host 32 bits \textbf{ne fonctionne pas}.}\\

\emph{\#lxc-ls}: obtenir la liste des containers cr\'e\'es --fancy pour plus de d\'etails.\\
  
\subsection{D\'emarrer un container}
\emph{\#lxc-start -n name  -d}: d\'emarrer le container de nom \emph{name} en daemon \emph{(-d)}.\\
Par d\'efaut, aucun compte utilisateur n'est cr\'e\'e. Il faut donc se connecter en root.\\ 

\emph{\#lxc-attach -n name}: se connecter en root sur le container \emph{name}.\\
Une fois un compte utilisateur cr\'e\'e, il est possible de lancer un terminal sur une session.\\

\emph{\#lxc-console -n name -t 0}: ouvrir un \'ecran de login sur le terminal tty0 du container \emph{name}.\footnote{\textbf{BUG:} sur certaines distributions, -t diff\'erent de 0 ne fonctionne pas}\\

\subsection{Configurer un container}
\subsubsection{Fichier de configuration}
Le fichier de configuration d'un container \emph{name} est /var/lib/lxc/\emph{name}/config. Voici un exemple de configuration de passerelle:\\
\emph{RTFM: lxc.container.conf}\\

\noindent
\textbf{/var/lib/lxc/passerelle/config}\\

\noindent
\# Distribution configuration\\
lxc.include = /usr/share/lxc/config/debian.common.conf\\
lxc.arch = x86\_64\\

\noindent
\# Container specific configuration\\
lxc.rootfs = /var/lib/lxc/passerelle/rootfs\\
lxc.rootfs.backend = dir\\
lxc.utsname = passerelle\\

\noindent
\# Network configuration\\
lxc.network.type = veth\\
lxc.network.name = eth0\\
lxc.network.link = lxcbr0\\
lxc.network.flags = up\\
lxc.network.hwaddr = 00:16:3e:5b:0e:8f\\
lxc.network.ipv4 = 172.16.1.1\\
lxc.network.ipv6 = fec00:0:0:2::1\\

\noindent
lxc.network.type = veth\\
lxc.network.name = eth1\\
lxc.network.link = lxcbr0\\
lxc.network.flags = up\\
lxc.network.hwaddr = 00:16:3e:5b:0e:8f\\
lxc.network.ipv4 = 192.168.1.1\\
lxc.network.ipv6 = fc00:0:0:1::1\\

Ici, le container poss\`ede deux interfaces (eth0 et eth1) avec chacune leurs adresses ipv4 (lxc.network.ipv4),
ipv6 (lxc.network.ipv6) et MAC (hwaddr).\\
lxc.network.flags indique quelle action effectuer (up active l'interface).\\
lxc.network.type indique quelle type de virtualisation de r√©seau utiliser (RTFM).\\
lxc.network.link indique l'interface \`a utiliser pour le vrai trafic, cette notion sera vu plus en d\'etail par la suite.\\

\subsubsection{ifconfig, ip}

***Commandes ip/ifconfig pour ipv4,ipv6***

\subsection{Relier les containers}
\subsubsection{Les Bridges -- Ponts}

Pour relier les containers entre eux, ou m\^eme au host, LXC utilise les bridge (pont en francais). Lors de
la cr\'eation d'un container, l'activation de chacune de ses interfaces va cr\'eer une interface sur la machine
host. Relier ces interfaces \`a un m\^eme pont permet de relier les containers "physiquement".\\

\noindent
\emph{\#brctl addbr br0}: cr\'ee un bridge de nom \emph{br0}\\
\emph{\#ifconfig br0 up}: active l'interface \emph{br0}



\end{document}

